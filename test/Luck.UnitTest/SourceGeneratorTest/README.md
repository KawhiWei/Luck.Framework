# ServiceRegistrationGenerator

åŸºäº IIncrementalGenerator çš„ SourceGeneratorï¼Œè‡ªåŠ¨ä¸ºå¸¦æœ‰ `BusinessServiceKeyAttribute` ç‰¹æ€§çš„ç±»ç”Ÿæˆ Keyed DI æ³¨å†Œæ‰©å±•æ–¹æ³•ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ åŸºäº IIncrementalGenerator å®ç°ï¼Œæ€§èƒ½ä¼˜å¼‚
- ğŸ¯ è‡ªåŠ¨æ‰«æå¸¦æœ‰ BusinessServiceKeyAttribute çš„ç±»
- ğŸ”§ æ”¯æŒä¸‰ç§ç”Ÿå‘½å‘¨æœŸï¼šSingletonã€Scopedã€Transient
- ğŸ”‘ æ”¯æŒ Keyed æœåŠ¡æ³¨å†Œ
- ğŸ› ï¸ ç”Ÿæˆç±»å‹å®‰å…¨çš„æ‰©å±•æ–¹æ³•

## ä½¿ç”¨æ–¹æ³•

### 1. æ ‡è®°æœåŠ¡ç±»

```csharp
// æŒ‡å®šæœåŠ¡ç±»å‹ã€æœåŠ¡é”®å’Œç”Ÿå‘½å‘¨æœŸ
[BusinessServiceKey(typeof(IUserService), "user", ServiceLifetime.Singleton)]
public class UserService : IUserService
{
    public Task<string> GetUserAsync(int id)
    {
        return Task.FromResult($"User {id}");
    }
}

[BusinessServiceKey(typeof(IOrderService), "order", ServiceLifetime.Scoped)]
public class OrderService : IOrderService
{
    public Task CreateOrderAsync(string userId)
    {
        return Task.CompletedTask;
    }
}
```

### 2. æ³¨å†ŒæœåŠ¡

```csharp
var services = new ServiceCollection();
services.AddBusinessServices(); // è°ƒç”¨ç”Ÿæˆçš„æ‰©å±•æ–¹æ³•

var serviceProvider = services.BuildServiceProvider();
```

### 3. è·å–KeyedæœåŠ¡

```csharp
var userService = serviceProvider.GetKeyedService<IUserService>("user");
var orderService = serviceProvider.GetKeyedService<IOrderService>("order");
```

## ç”Ÿæˆçš„ä»£ç ç¤ºä¾‹

SourceGenerator ä¼šè‡ªåŠ¨ç”Ÿæˆç±»ä¼¼ä»¥ä¸‹çš„æ‰©å±•æ–¹æ³•ï¼š

```csharp
// <auto-generated />
using Microsoft.Extensions.DependencyInjection;

namespace Luck.TestBase.SourceGenerators;

public static class ServiceCollectionExtensions
{
    public static IServiceCollection AddBusinessServices(this IServiceCollection services)
    {
        services.AddKeyedSingleton<IUserService, UserService>("user");
        services.AddKeyedScoped<IOrderService, OrderService>("order");
        services.AddKeyedTransient<IUserService, AdminUserService>("admin");
        return services;
    }
}
```

## æ”¯æŒçš„ç”Ÿå‘½å‘¨æœŸ

- `ServiceLifetime.Singleton` -> `AddKeyedSingleton`
- `ServiceLifetime.Transient` -> `AddKeyedTransient`  
- `ServiceLifetime.Scoped` -> `AddKeyedScoped` (é»˜è®¤)